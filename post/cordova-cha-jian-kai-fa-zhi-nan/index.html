<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cordovaæ’ä»¶å¼€å‘æŒ‡å— | It&#39;s my life</title>
<link rel="shortcut icon" href="https://merpyzf.github.io/favicon.ico?v=1587958414258">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://merpyzf.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Cordovaæ’ä»¶å¼€å‘æŒ‡å— | It&#39;s my life - Atom Feed" href="https://merpyzf.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="ä¸‹æ–‡ä¸ºå¯¹Cordovaå®˜ç½‘æ’ä»¶å¼€å‘çš„ç¿»è¯‘ã€‚
ç®€ä»‹
æ’ä»¶æ˜¯æ³¨å…¥çš„ä»£ç åŒ…ï¼Œå¯è®©Cordova Webè§†å›¾åœ¨è¯¥è§†å›¾ä¸­æ¸²æŸ“åº”ç”¨ç¨‹åºå¹¶ä¸å…¶è¿è¡Œæ‰€åœ¨çš„æœ¬æœºå¹³å°è¿›è¡Œé€šä¿¡ã€‚æ’ä»¶æä¾›å¯¹é€šå¸¸åŸºäºWebçš„åº”ç”¨ç¨‹åºä¸å¯ç”¨çš„è®¾å¤‡å’Œå¹³å°åŠŸèƒ½çš„è®¿é—®ã€‚ Cordova A..." />
    <meta name="keywords" content="Cordova" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://merpyzf.github.io">
  <img class="avatar" src="https://merpyzf.github.io/images/avatar.png?v=1587958414258" alt="">
  </a>
  <h1 class="site-title">
    It&#39;s my life
  </h1>
  <p class="site-description">
    çœŸæ­£çš„å…‰èŠ’ï¼Œéœ€è¦ä¸€ç‚¹ç‚¹æ—¶é—´
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Cordovaæ’ä»¶å¼€å‘æŒ‡å—
            </h2>
            <div class="post-info">
              <span>
                2020-03-11
              </span>
              <span>
                14 min read
              </span>
              
                <a href="https://merpyzf.github.io/tag/oNOI8yLSr/" class="post-tag">
                  # Cordova
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://merpyzf.github.io/post-images/cordova-cha-jian-kai-fa-zhi-nan.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>ä¸‹æ–‡ä¸ºå¯¹<a href="https://cordova.apache.org/docs/en/9.x/guide/hybrid/plugins">Cordovaå®˜ç½‘æ’ä»¶å¼€å‘</a>çš„ç¿»è¯‘ã€‚</p>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<p>æ’ä»¶æ˜¯æ³¨å…¥çš„ä»£ç åŒ…ï¼Œå¯è®©Cordova Webè§†å›¾åœ¨è¯¥è§†å›¾ä¸­æ¸²æŸ“åº”ç”¨ç¨‹åºå¹¶ä¸å…¶è¿è¡Œæ‰€åœ¨çš„æœ¬æœºå¹³å°è¿›è¡Œé€šä¿¡ã€‚æ’ä»¶æä¾›å¯¹é€šå¸¸åŸºäºWebçš„åº”ç”¨ç¨‹åºä¸å¯ç”¨çš„è®¾å¤‡å’Œå¹³å°åŠŸèƒ½çš„è®¿é—®ã€‚ Cordova APIçš„æ‰€æœ‰ä¸»è¦åŠŸèƒ½å‡ä½œä¸ºæ’ä»¶å®ç°ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½å¯å¯ç”¨è¯¸å¦‚æ¡å½¢ç æ‰«æä»ªï¼ŒNFCé€šä¿¡æˆ–å®šåˆ¶æ—¥å†ç•Œé¢ç­‰åŠŸèƒ½ã€‚</p>
<p>æ’ä»¶åŒ…å«ä¸€ä¸ªJavaScriptæ¥å£(æ’ä»¶wwwç›®å½•ä¸‹çš„jsæ–‡ä»¶)ï¼Œä»¥åŠæ¯ä¸ªå—æ”¯æŒå¹³å°çš„ç›¸åº”æœ¬æœºä»£ç åº“ã€‚æœ¬è´¨ä¸Šï¼Œè¿™å°†å„ç§æœ¬æœºä»£ç å®ç°éšè—åœ¨é€šç”¨JavaScriptæ¥å£çš„åé¢ï¼Œæ‚¨å¯ä»¥å°†å…¶ç”¨ä½œæ¨¡å‹æ¥æ„å»ºæ›´å¤æ‚çš„åŠŸèƒ½ã€‚æœ¬èŠ‚è®¨è®ºåŸºæœ¬çš„æ’ä»¶ç»“æ„å’Œé¢å‘å¤–éƒ¨çš„JavaScriptæ¥å£ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://merpyzf.github.io/post-images/1583897837999.png" alt=" Cordova åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„" loading="lazy"></figure>
<h3 id="å‘é¡¹ç›®ä¸­æ·»åŠ æ’ä»¶">å‘é¡¹ç›®ä¸­æ·»åŠ æ’ä»¶</h3>
<p>åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ä½¿ç”¨CLIçš„plugin addå‘½ä»¤å°†æ’ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚è¯¥å‘½ä»¤çš„å‚æ•°æ˜¯åŒ…å«æ’ä»¶ä»£ç çš„gitå­˜å‚¨åº“çš„URL(ä¹Ÿå¯ä»¥æ˜¯æ’ä»¶æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„)ã€‚æ­¤ç¤ºä¾‹å®ç°äº†Cordovaçš„è®¾å¤‡APIï¼š</p>
<pre><code>cordova plugin add https://git-wip-us.apache.org/repos/asf/cordova-plugin-device.git
</code></pre>
<p>å­˜å‚¨åœ¨gitä¸Šçš„æ’ä»¶å­˜å‚¨åº“å¿…é¡»å…·æœ‰é¡¶çº§çš„plugin.xmlæ¸…å•æ–‡ä»¶ã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥é…ç½®æ­¤æ–‡ä»¶ï¼Œæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://cordova.apache.org/docs/en/9.x/plugin_ref/spec.html">æ’ä»¶è§„èŒƒ</a>ã€‚<br>
ğŸ‘‡è¿™ä¸ªç®€çŸ­çš„Deviceæ’ä»¶ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å±•ç¤ºï¼š</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;plugin xmlns=&quot;http://apache.org/cordova/ns/plugins/1.0&quot;
        id=&quot;cordova-plugin-device&quot; version=&quot;0.2.3&quot;&gt;
    &lt;name&gt;Device&lt;/name&gt;
    &lt;description&gt;Cordova Device Plugin&lt;/description&gt;
    &lt;license&gt;Apache 2.0&lt;/license&gt;
    &lt;keywords&gt;cordova,device&lt;/keywords&gt;
    &lt;js-module src=&quot;www/device.js&quot; name=&quot;device&quot;&gt;
        &lt;clobbers target=&quot;device&quot; /&gt;
    &lt;/js-module&gt;
    &lt;platform name=&quot;ios&quot;&gt;
        &lt;config-file target=&quot;config.xml&quot; parent=&quot;/*&quot;&gt;
            &lt;feature name=&quot;Device&quot;&gt;
                &lt;param name=&quot;ios-package&quot; value=&quot;CDVDevice&quot;/&gt;
            &lt;/feature&gt;
        &lt;/config-file&gt;
        &lt;header-file src=&quot;src/ios/CDVDevice.h&quot; /&gt;
        &lt;source-file src=&quot;src/ios/CDVDevice.m&quot; /&gt;
    &lt;/platform&gt;
&lt;/plugin&gt;
</code></pre>
<p>é¡¶çº§æ’ä»¶æ ‡ç­¾çš„idå±æ€§ä½¿ç”¨ç›¸åŒçš„åå‘åŸŸæ ¼å¼æ¥æ ‡è¯†æ’ä»¶åŒ…æ·»åŠ åˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºæ‰€èƒ½è¯†åˆ«çš„æ’ä»¶åŒ…ï¼Œjs-moduleæ ‡è®°æŒ‡å®šé€šç”¨JavaScriptæ¥å£ï¼ˆå³ä¸nativeå±‚é€šä¿¡çš„jsï¼‰çš„è·¯å¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œplatformæ ‡ç­¾ä¸ºioså¹³å°æŒ‡å®šäº†ä¸€ç»„å¯¹åº”çš„æœ¬æœºä»£ç ï¼ˆç»†åŒ–åˆ°æ¯ä¸€ä¸ªæºä»£ç æ–‡ä»¶çš„æºæ–‡ä»¶ä½ç½®å’Œå¯¼å‡ºåˆ°å¹³å°åè¦æ”¾ç½®çš„ä½ç½®ï¼Œä»¥åŠå¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼‰ã€‚config-fileæ ‡è®°å°è£…äº†åŠŸèƒ½æ ‡è®°ï¼Œè¯¥featureæ ‡è®°æ³¨å…¥åˆ°ç‰¹å®šäºå¹³å°çš„config.xmlæ–‡ä»¶ä¸­ï¼Œä»¥ä½¿å¹³å°çŸ¥é“å…¶ä»–çš„ä»£ç åº“ã€‚header-fileå’Œsource-fileæ ‡ç­¾æŒ‡å®šå¤´æ–‡ä»¶å’Œæºç æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<h3 id="ä½¿ç”¨plugmanéªŒè¯æ’ä»¶">ä½¿ç”¨PlugmanéªŒè¯æ’ä»¶</h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨plugmanå®ç”¨ç¨‹åºæ¥æ£€æŸ¥æ’ä»¶æ˜¯å¦é’ˆå¯¹æ¯ä¸ªå¹³å°æ­£ç¡®å®‰è£…ã€‚ä½¿ç”¨ä»¥ä¸‹èŠ‚ç‚¹å‘½ä»¤å®‰è£…plugmanï¼š</p>
<pre><code>pm install -g plugman
</code></pre>
<p>ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æµ‹è¯•iOSä¾èµ–é¡¹æ˜¯å¦æ­£ç¡®åŠ è½½ï¼š</p>
<pre><code>plugman install --platform ios --project /path/to/my/project/www --plugin /path/to/my/plugin
</code></pre>
<h3 id="javascriptæ¥å£">JavaScriptæ¥å£</h3>
<p>JavaScriptæ¥å£æä¾›äº†é¢å‘å‰ç«¯è°ƒç”¨Nativeå±‚åŠŸèƒ½çš„æ¥å£ï¼Œä½¿å…¶æˆä¸ºæ’ä»¶ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥éšæ„æ„å»ºæ’ä»¶çš„JavaScriptï¼Œä½†éœ€è¦ä½¿ç”¨ä»¥ä¸‹è¯­æ³•è°ƒç”¨cordova.execä¸Nativeå±‚è¿›è¡Œé€šä¿¡ï¼š</p>
<pre><code>cordova.exec(function(winParam) {},
             function(error) {},
             &quot;service&quot;,
             &quot;action&quot;,
             [&quot;firstArgument&quot;, &quot;secondArgument&quot;, 42, false]);
</code></pre>
<p>ğŸ‘‡ä»‹ç»æ¯ä¸ªå‚æ•°çš„å·¥ä½œåŸç†ï¼š</p>
<ul>
<li>function(winParam) {}ï¼šæˆåŠŸçš„å›è°ƒå‡½æ•°ã€‚å‡è®¾æ‚¨çš„execè°ƒç”¨æˆåŠŸå®Œæˆï¼Œæ­¤å‡½æ•°å°†è¢«æ‰§è¡Œå¹¶æºå¸¦Nativeå±‚ä¼ é€’çš„å…³äºæˆåŠŸä¿¡æ¯çš„å‚æ•°ã€‚</li>
<li>function(error) {}: å¤±è´¥çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœæ“ä½œæœªæˆåŠŸå®Œæˆï¼Œæ­¤å‡½æ•°å°†è¢«æ‰§è¡Œå¹¶æºå¸¦Nativeå±‚ä¼ é€’çš„å…³äºå¤±è´¥ä¿¡æ¯çš„å‚æ•°ã€‚</li>
<li>&quot;service&quot;ï¼šåœ¨Nativeç«¯è°ƒç”¨çš„æœåŠ¡åç§°ã€‚è¿™å¯¹åº”äºNativeå±‚çš„ç±».</li>
<li>&quot;action&quot;: åœ¨Nativeç«¯è°ƒç”¨çš„æ“ä½œåç§°ã€‚è¿™é€šå¸¸å¯¹åº”äºNativeå±‚ç±»ä¸­ç”¨äºå®ç°æ’ä»¶åŠŸèƒ½çš„æ–¹æ³•åç§°ã€‚</li>
<li>[/* arguments */]: ä¸€ä¸ªJsonæ•°ç»„å¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ é€’åˆ°Nativeå±‚çš„æ–¹æ³•ä¸­ã€‚</li>
</ul>
<p>JavaScriptæ’ä»¶è°ƒç”¨ç¤ºä¾‹ï¼š</p>
<p>ğŸ‘‡ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ç§å®ç°è°ƒç”¨æ’ä»¶JavaScriptæ¥å£çš„æ–¹æ³•ï¼š</p>
<pre><code>window.echo = function(str, callback) {
    cordova.exec(callback, function(err) {
        callback('Nothing to echo.');
    }, &quot;Echo&quot;, &quot;echo&quot;, [str]);
};
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ’ä»¶å°†è‡ªèº«ä½œä¸ºechoå‡½æ•°é™„åŠ åˆ°windowå¯¹è±¡ä¸Šï¼Œè¯¥æ’ä»¶å°†è¢«ç”¨æˆ·æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è°ƒç”¨ï¼š</p>
<pre><code>window.echo(&quot;echome&quot;, function(echoValue) {
    alert(echoValue == &quot;echome&quot;); // should alert true.
});
</code></pre>
<h3 id="nativeå±‚å®ç°">Nativeå±‚å®ç°</h3>
<p>ä¸ºæ’ä»¶å®šä¹‰JavaScriptæ¥å£åï¼Œè‡³å°‘éœ€è¦ä½¿ç”¨ä¸€ç§æœ¬æœºå®ç°å¯¹å…¶è¿›è¡Œè¡¥å……ã€‚ä¸‹é¢å°†ä»‹ç»<br>
Androidå±‚çš„å®ç°ï¼ˆå› ä¸ºæœ¬äººåªç†Ÿæ‚‰Androidå¹³å°çš„å¼€å‘ï¼‰ã€‚</p>
<h4 id="androidæ’ä»¶å¼€å‘è¯´æ˜">Androidæ’ä»¶å¼€å‘è¯´æ˜</h4>
<p>Androidæ’ä»¶åŸºäº Cordova-Androidã€‚å®ƒçš„ä½œç”¨æ˜¯æ„å»ºä¸€åº§ä»WebViewé€šå‘Nativeçš„æ¡¥æ¢ã€‚Androidæ’ä»¶çš„Nativeéƒ¨åˆ†è‡³å°‘è¦åŒ…å«ä¸€ä¸ªJavaç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªCordovaPluginç±»å¹¶é‡å†™çˆ¶ç±»çš„executeæ–¹æ³•ã€‚</p>
<h5 id="æ’ä»¶ç±»æ˜ å°„">æ’ä»¶ç±»æ˜ å°„</h5>
<p>æ’ä»¶çš„JavaScriptæ¥å£ä½¿ç”¨cordova.execæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>exec(&lt;successFunction&gt;, &lt;failFunction&gt;, &lt;service&gt;, &lt;action&gt;, [&lt;args&gt;]);
</code></pre>
<p>è¿™å°è£…äº†ä»WebViewåˆ°Androidæœ¬æœºç«¯çš„è¯·æ±‚ï¼Œå®Œæˆäº†å¯¹serviceç±»ä¸Šçš„actionæ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶å‘actionæ–¹æ³•ä¸­ä¼ é€’äº†argsæ•°ç»„å‚æ•°ã€‚</p>
<p>æ— è®ºæ‚¨æ˜¯ä»¥Javaæ–‡ä»¶è¿˜æ˜¯ä»¥è‡ªå·±çš„jaræ–‡ä»¶å‘å¸ƒæ’ä»¶ï¼Œå¿…é¡»åœ¨æ‚¨çš„Cordova-Androidåº”ç”¨ç¨‹åºçš„res / xml / config.xmlæ–‡ä»¶ä¸­æŒ‡å®šè¯¥æ’ä»¶ã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨plugin.xmlæ–‡ä»¶æ³¨å…¥æ­¤åŠŸèƒ½å…ƒç´ çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§åº”ç”¨ç¨‹åºæ’ä»¶ï¼š</p>
<pre><code> &lt;platform name=&quot;android&quot;&gt;
        &lt;config-file parent=&quot;/*&quot; target=&quot;res/xml/config.xml&quot;&gt;
            &lt;feature name=&quot;&lt;service_name&gt;&quot;&gt;
                &lt;param name=&quot;android-package&quot; value=&quot;&lt;full_name_including_namespace&gt;&quot; /&gt;
            &lt;/feature&gt;
        &lt;/config-file&gt;
        ...
&lt;/platform&gt;
</code></pre>
<p>__service_nameä¸JavaScript execè°ƒç”¨ä¸­ä½¿ç”¨çš„åç§°ç›¸åŒ¹é…ã€‚valueçš„å€¼æ˜¯ç»§æ‰¿äº†CordovaPluginç±»çš„å…¨è·¯å¾„ã€‚__å¦‚æœé…ç½®æœ‰è¯¯ï¼Œè¯¥æ’ä»¶è™½ç„¶å¯èƒ½ä¼šé€šè¿‡ç¼–è¯‘ï¼Œä½†Cordovaä»æ— æ³•å®Œæˆæ’ä»¶è°ƒç”¨ã€‚</p>
<h5 id="æ’ä»¶åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸ">æ’ä»¶åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸ</h5>
<p>åœ¨æ¯ä¸ªWebViewçš„ç”Ÿå­˜æœŸå†…ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ’ä»¶å¯¹è±¡çš„å®ä¾‹ã€‚ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶ä¸ä¼šè·ŸéšWebViewä¸€åŒåˆ›å»ºï¼Œè€Œæ˜¯ç›´åˆ°JavaScriptè°ƒç”¨é¦–æ¬¡å¼•ç”¨æ’ä»¶æ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ–æ’ä»¶ã€‚é™¤éåœ¨config.xmlä¸­å°†å…·æœ‰onload nameå±æ€§çš„<param>è®¾ç½®ä¸ºâ€œ trueâ€ã€‚ä¾‹å¦‚ï¼Œ</p>
<pre><code>&lt;!-- è®¾ç½®è·ŸéšWebViewåˆå§‹åŒ–æ’ä»¶ --&gt;
&lt;feature name=&quot;Echo&quot;&gt;
    &lt;param name=&quot;android-package&quot; value=&quot;&lt;full_name_including_namespace&gt;&quot; /&gt;
    &lt;param name=&quot;onload&quot; value=&quot;true&quot; /&gt;
&lt;/feature&gt;
</code></pre>
<p>æ’ä»¶åœ¨å¯åŠ¨æ—¶å°†ä¼šå»å›è°ƒinitializeæ–¹æ³•ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•å†…éƒ¨åšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚</p>
<pre><code>@Override
public void initialize(CordovaInterface cordova, CordovaWebView webView) {
    super.initialize(cordova, webView);
    // your init code here
}
</code></pre>
<p>æ’ä»¶è¿˜å¯ä»¥è®¿é—®Androidç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å®ç°çˆ¶ç±»CordovaPluginæä¾›çš„æ–¹æ³•ï¼ˆonResumeï¼ŒonDestroyç­‰ï¼‰æ¥å¤„ç†å®ƒä»¬ã€‚å…·æœ‰é•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚ã€åå°æ´»åŠ¨(å¦‚åª’ä½“æ’­æ”¾ã€ä¾¦å¬å™¨æˆ–å†…éƒ¨çŠ¶æ€)çš„æ’ä»¶åº”è¯¥å®ç° onReset ()æ–¹æ³•ã€‚ å®ƒåœ¨ WebView å¯¼èˆªåˆ°æ–°é¡µé¢æˆ–åˆ·æ–°æ—¶æ‰§è¡Œï¼Œè¿™ä¼šé‡æ–°åŠ è½½ JavaScriptã€‚</p>
<h5 id="ç¼–å†™ä¸€ä¸ªandroidæ’ä»¶">ç¼–å†™ä¸€ä¸ªAndroidæ’ä»¶</h5>
<p>ä¸€ä¸ªJavaScriptè°ƒç”¨å°†å‘Nativeå±‚å‘å‡ºä¸€ä¸ªæ’ä»¶è°ƒç”¨è¯·æ±‚ï¼Œå¹¶ä¸”ç›¸åº”çš„Javaæ’ä»¶å·²æ­£ç¡®æ˜ å°„åˆ°config.xmlæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æœ€ç»ˆçš„Android Java Pluginç±»æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿä½¿ç”¨JavaScriptçš„execå‡½æ•°è°ƒç”¨çš„æ’ä»¶å›å°†æ‰€æœ‰çš„å†…å®¹ä¼ é€’åˆ°æ’ä»¶ç±»çš„execute æ–¹æ³•ä¸­ã€‚å¤§å¤šæ•°æ‰§è¡Œå®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>@Override
public boolean execute(String action, JSONArray args, CallbackContext callbackContext) throws JSONException {
    if (&quot;beep&quot;.equals(action)) {
        this.beep(args.getLong(0));
        callbackContext.success();
        return true;
    }
    return false;  // Returning false results in a &quot;MethodNotFound&quot; error.
}
</code></pre>
<p>å¯ä»¥é€šè¿‡actionå‚æ•°æ¥åˆ†é…æœ¬æ¬¡è°ƒç”¨éœ€è¦æ‰§è¡Œçš„æ–¹æ³•ã€‚<strong>å½“æ’ä»¶ç±»çš„executeæ–¹æ³•æ‰§è¡Œåå¦‚æœæœ€åè¿”å›çš„æ˜¯falseï¼Œåˆ™ä¼šåœ¨JSå±‚æŠ›å‡º &quot;MethodNotFound&quot; çš„é”™è¯¯ã€‚</strong></p>
<h5 id="çº¿ç¨‹">çº¿ç¨‹</h5>
<p><strong>æ’ä»¶çš„JavaScriptä¸åœ¨WebViewç•Œé¢çš„ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼›ç›¸åï¼Œå®ƒä¸executeæ–¹æ³•ä¸€æ ·åœ¨WebCoreçº¿ç¨‹ä¸Šè¿è¡Œ</strong>ã€‚å¦‚æœéœ€è¦ä¸ç”¨æˆ·ç•Œé¢è¿›è¡Œäº¤äº’ï¼Œåˆ™åº”ä½¿ç”¨Activityçš„runOnUiThreadæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>@Override
public boolean execute(String action, JSONArray args, final CallbackContext callbackContext) throws JSONException {
    if (&quot;beep&quot;.equals(action)) {
        final long duration = args.getLong(0);
        cordova.getActivity().runOnUiThread(new Runnable() {
            public void run() {
                Toast.make(context, &quot;hi&quot;, Toast.LENGTH_SHORT).show();
                callbackContext.success(); // Thread-safe.
            }
        });
        return true;
    }
    return false;
}
</code></pre>
<p>å¦‚æœä¸éœ€è¦åœ¨UIçº¿ç¨‹ä¸Šè¿è¡Œï¼Œä½†æ˜¯ä¹Ÿä¸æƒ³é˜»å¡WebCoreçº¿ç¨‹ï¼Œåˆ™åº”é€šè¿‡cordova.getThreadPoolï¼ˆï¼‰è·å¾—çš„Cordovaçš„ExecutorServiceï¼ˆJavaä¸­å¯¹çº¿ç¨‹æ± å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼‰æ‰§è¡Œä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>@Override
public boolean execute(String action, JSONArray args, final CallbackContext callbackContext) throws JSONException {
    if (&quot;beep&quot;.equals(action)) {
        final long duration = args.getLong(0);
        cordova.getThreadPool().execute(new Runnable() {
            public void run() {
                ...
                callbackContext.success(); // Thread-safe.
            }
        });
        return true;
    }
    return false;
}
</code></pre>
<h5 id="æ·»åŠ ä¾èµ–åº“">æ·»åŠ ä¾èµ–åº“</h5>
<p>å¦‚æœæ‚¨çš„Androidæ’ä»¶å…·æœ‰é¢å¤–çš„ä¾èµ–ï¼Œåˆ™å¿…é¡»é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€åœ¨plugin.xmlä¸­åˆ—å‡ºå®ƒä»¬ã€‚</p>
<h6 id="æ–¹æ³•1">æ–¹æ³•1:</h6>
<p>ä½¿ç”¨ frameworkæ ‡è®°ï¼Œ<strong>ä»¥è¿™ç§æ–¹å¼æŒ‡å®šåº“å…è®¸é€šè¿‡Gradleçš„ä¾èµ–ç®¡ç†é€»è¾‘å¯¹å…¶è¿›è¡Œè§£æã€‚è¿™å…è®¸å¤šä¸ªæ’ä»¶ä½¿ç”¨é€šç”¨åº“ï¼ˆä¾‹å¦‚gsonï¼Œandroid-support-v4å’Œgoogle-play-servicesï¼‰è€Œä¸ä¼šå‘ç”Ÿå†²çªã€‚</strong><br>
ä¸‹é¢ä¸ºé€šè¿‡frameworkæ ‡è®°å¼•å…¥ä¾èµ–åº“çš„ç¤ºä¾‹ï¼š</p>
<pre><code>&lt;!-- Depend on latest version of GCM from play services --&gt;
&lt;framework src=&quot;com.google.android.gms:play-services-gcm:+&quot; /&gt;
&lt;!-- Depend on v21 of appcompat-v7 support library --&gt;
&lt;framework src=&quot;com.android.support:appcompat-v7:21+&quot; /&gt;
&lt;!-- Depend on library project included in plugin --&gt;
&lt;framework src=&quot;relative/path/FeedbackLib&quot; custom=&quot;true&quot; /&gt;
</code></pre>
<p>Frameworkä¹Ÿå¯ä»¥ç”¨äºå°†è‡ªå®šä¹‰.gradleæ–‡ä»¶åŒ…å«åœ¨æ’ä»¶ä¸»é¡¹ç›®çš„build.gradleæ–‡ä»¶ä¸­:</p>
<figure data-type="image" tabindex="2"><img src="https://merpyzf.github.io/post-images/1583899538203.png" alt="" loading="lazy"></figure>
<h6 id="æ–¹æ³•2">æ–¹æ³•2:</h6>
<p>ä½¿ç”¨lib-fileæ ‡è®°æŒ‡å®šjaræ–‡ä»¶çš„ä½ç½®,ä»…å½“æ‚¨ç¡®å®šæ²¡æœ‰å…¶ä»–æ’ä»¶å¼•ç”¨è¯¥åº“æ—¶æ‰åº”ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ï¼ˆå¦‚æœæœ‰å¤šä¸ªæ’ä»¶é€šè¿‡lib-fileæ ‡è®°å¼•ç”¨äº†ç›¸åŒçš„jarï¼Œå°†ä¼šå¯¼è‡´å†²çªå‘ç”Ÿï¼‰ã€‚å¦åˆ™ï¼Œå¦‚æœå¦ä¸€ä¸ªæ’ä»¶æ·»åŠ ç›¸åŒçš„åº“ï¼Œåˆ™å¯èƒ½ä¼šç»™æ’ä»¶çš„ç”¨æˆ·é€ æˆæ„å»ºé”™è¯¯ã€‚</p>
<h5 id="androidæ•´åˆ">Androidæ•´åˆ</h5>
<p>Androidå…·æœ‰Intentç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå…è®¸è¿›ç¨‹ç›¸äº’é€šä¿¡ã€‚æ’ä»¶å¯ä»¥è®¿é—®CordovaInterfaceå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥è®¿é—®è¿è¡Œè¯¥åº”ç”¨ç¨‹åºçš„Android ã€‚ CordovaInterfaceå…è®¸æ’ä»¶å…è®¸å¯åŠ¨ä¸€ä¸ªå¯ä»¥è¿”å›ç»“æœçš„Activityã€‚ä»Cordova 2.0å¼€å§‹ï¼Œæ’ä»¶ä¸å†å¯ä»¥ç›´æ¥è®¿é—®Contextï¼Œå¹¶ä¸”å·²å¼ƒç”¨æ—§ç‰ˆctxæˆå‘˜ã€‚æ‰€æœ‰ctxæ–¹æ³•éƒ½å­˜åœ¨äºContextä¸Šï¼Œå› æ­¤é€šè¿‡getContextï¼ˆï¼‰å’ŒgetActivityï¼ˆï¼‰éƒ½å¯ä»¥è¿”å›æ‰€éœ€çš„å¯¹è±¡ã€‚</p>
<h5 id="androidé™æ€æƒé™">Androidé™æ€æƒé™</h5>
<p>å¯¹äºåœ¨é‚£äº›åœ¨å®‰è£…æ—¶æˆæƒè€Œéåœ¨è¿è¡Œæ—¶æˆæƒçš„æƒé™ï¼Œéœ€è¦å°†è¿™äº›åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å±‚çš„æƒé™æ·»åŠ åˆ°Androidæ¸…å•ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨config.xmlå°†è¿™äº›æƒé™æ³¨å…¥åˆ°AndroidManifest.xmlæ–‡ä»¶æ¥å®Œæˆã€‚ä¸‹é¢ä¸ºç”³è¯·æƒé™çš„ç¤ºä¾‹ï¼š</p>
<pre><code>    &lt;config-file target=&quot;AndroidManifest.xml&quot; parent=&quot;/manifest&quot;&gt;
            &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot;/&gt;
            &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot;/&gt;
            &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;
        &lt;/config-file&gt;
</code></pre>
<h5 id="androidè¿è¡Œæ—¶æƒé™">Androidè¿è¡Œæ—¶æƒé™</h5>
<p>Android 6.0â€œæ£‰èŠ±ç³–â€å¼•å…¥äº†æ–°çš„æƒé™æ¨¡å‹ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦æ‰“å¼€å’Œå…³é—­æƒé™ã€‚è¿™æ„å‘³ç€åº”ç”¨ç¨‹åºå¿…é¡»å¤„ç†è¿™äº›æƒé™æ›´æ”¹ï¼Œä»¥ç¡®ä¿æ—¶æ•ˆæ€§ï¼Œè¿™æ˜¯Cordova-Android 5.0.0ç‰ˆæœ¬çš„é‡ç‚¹ã€‚å¯ä»¥åœ¨<a href="http://developer.android.com/guide/topics/security/permissions.html#perm-groups">æ­¤å¤„</a>çš„Android Developeræ–‡æ¡£ä¸­æ‰¾åˆ°éœ€è¦åœ¨è¿è¡Œæ—¶å¤„ç†çš„æƒé™ã€‚</p>
<p>å°±æ’ä»¶è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨æƒé™æ–¹æ³•æ¥è¯·æ±‚æƒé™ã€‚æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>
<pre><code>cordova.requestPermission(CordovaPlugin plugin, int requestCode, String permission);
</code></pre>
<p>ä¸ºäº†å‡å°‘å†—é•¿ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å°†å…¶åˆ†é…ç»™å±€éƒ¨é™æ€å˜é‡ï¼š</p>
<pre><code>public static final String READ = Manifest.permission.READ_CONTACTS;
</code></pre>
<p>æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®šä¹‰requestCodeä¹Ÿæ˜¯æ ‡å‡†åšæ³•ï¼š</p>
<pre><code>public static final int SEARCH_REQ_CODE = 0;
</code></pre>
<p>ç„¶åï¼Œåœ¨execæ–¹æ³•ä¸­ï¼Œåº”æ£€æŸ¥æƒé™ï¼š</p>
<pre><code>if(cordova.hasPermission(READ))
{
    search(executeArgs);
}
else
{
    getReadPermission(SEARCH_REQ_CODE);
}
</code></pre>
<p>åœ¨getReadPermissionæ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨requestPermissionæ¥ç”³è¯·æƒé™ï¼š</p>
<pre><code>protected void getReadPermission(int requestCode)
{
    cordova.requestPermission(this, requestCode, READ);
}
</code></pre>
<p>æ‰§è¡Œä¸Šè¿°è¯­å¥åå°†ä¼šå¼¹å‡ºæƒé™æˆæƒå¼¹çª—ï¼Œä¹‹åäº¤ç”±ç”¨æˆ·å¤„ç†ã€‚å½“ç”¨æˆ·å¤„ç†å®Œæˆåï¼Œæ’ä»¶å°†ä¼šå›è°ƒonRequestPermissionResultæ¥è¿”å›å¯¹æƒé™çš„æˆæƒç»“æœã€‚æ¯ä¸ªæ’ä»¶éƒ½åº”è¯¥é‡å†™æ­¤æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code>public void onRequestPermissionResult(int requestCode, String[] permissions,
                                         int[] grantResults) throws JSONException
{
    for(int r:grantResults)
    {
        if(r == PackageManager.PERMISSION_DENIED)
        {
            this.callbackContext.sendPluginResult(new PluginResult(PluginResult.Status.ERROR, PERMISSION_DENIED_ERROR));
            return;
        }
    }
    switch(requestCode)
    {
        case SEARCH_REQ_CODE:
            search(executeArgs);
            break;
        case SAVE_REQ_CODE:
            save(executeArgs);
            break;
        case REMOVE_REQ_CODE:
            remove(executeArgs);
            break;
    }
}
</code></pre>
<p>é™¤äº†ä¸ºå•ä¸ªæƒé™è¯·æ±‚æƒé™å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®šä¹‰æƒé™æ•°ç»„æ¥è¯·æ±‚æ•´ä¸ªç»„çš„æƒé™ï¼Œå°±åƒä½¿ç”¨Geolocationæ’ä»¶é‚£æ ·ï¼š</p>
<pre><code>String [] permissions = { Manifest.permission.ACCESS_COARSE_LOCATION, Manifest.permission.ACCESS_FINE_LOCATION };
</code></pre>
<p>ç„¶ååœ¨å¯¹ç»„çš„æƒé™è¿›è¡Œç”³è¯·æ—¶ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<pre><code>cordova.requestPermissions(this, 0, permissions);
</code></pre>
<h5 id="å¯åŠ¨å…¶ä»–æ´»åŠ¨">å¯åŠ¨å…¶ä»–æ´»åŠ¨</h5>
<p>å¾…æ·»åŠ </p>
<h3 id="å‘å¸ƒæ’ä»¶">å‘å¸ƒæ’ä»¶</h3>
<p>æ‚¨å¯ä»¥å°†æ’ä»¶å‘å¸ƒåˆ°ä»»ä½•åŸºäºnpmjsçš„æ³¨å†Œè¡¨ï¼Œä½†æ˜¯æ¨èçš„æ’ä»¶æ˜¯npmæ³¨å†Œè¡¨ã€‚å…¶ä»–å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Plugmanæˆ–Cordova CLIè‡ªåŠ¨å®‰è£…æ‚¨çš„æ’ä»¶ã€‚</p>
<p>è¦å°†æ’ä»¶å‘å¸ƒåˆ°npmï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>å®‰è£…plugmanå‘½ä»¤è¡Œå·¥å…·ï¼š<pre><code>$ npm install -g plugman
</code></pre>
</li>
<li>ä¸ºæ’ä»¶åˆ›å»ºä¸€ä¸ªpackage.jsonæ–‡ä»¶<pre><code>$ plugman createpackagejson /path/to/your/plugin
</code></pre>
</li>
<li>å‘å¸ƒå®ƒï¼š<pre><code>$ npm adduser # that is if you don't have an account yet
 $ npm publish /path/to/your/plugin
</code></pre>
</li>
</ol>
<!-- ### æŒ‡å®šCordovaä¾èµ–é¡¹
Cordova 6.1.0æ·»åŠ äº†å¯¹æŒ‡å®šæ’ä»¶çš„Cordovaç›¸å…³ä¾èµ–é¡¹çš„æ”¯æŒï¼Œä½œä¸ºæ’ä»¶çš„package.jsonæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚æ’ä»¶å¯èƒ½ä¼šåˆ—å‡ºå¤šä¸ªå‘è¡Œç‰ˆçš„ä¾èµ–å…³ç³»ï¼Œä»¥åœ¨Cordova CLIé€‰æ‹©è¦ä»npmè·å–çš„æ’ä»¶ç‰ˆæœ¬æ—¶å‘å…¶æä¾›æŒ‡å¯¼ã€‚CLIå°†é€‰æ‹©ä¸æœ¬åœ°é¡¹ç›®çš„å·²å®‰è£…å¹³å°å’Œæ’ä»¶ä»¥åŠæœ¬åœ°Cordova CLIç‰ˆæœ¬å…¼å®¹çš„æœ€æ–°ç‰ˆæœ¬çš„æ’ä»¶ã€‚å¦‚æœæ²¡æœ‰å…¼å®¹çš„æ’ä»¶ç‰ˆæœ¬ï¼Œåˆ™CLIå°†è­¦å‘Šç”¨æˆ·æœ‰å…³å¤±è´¥çš„è¦æ±‚ï¼Œå¹¶é€€å›è·å–æœ€æ–°ç‰ˆæœ¬çš„æ—§è¡Œä¸ºã€‚ -->

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B">ç®€ä»‹</a></li>
<li><a href="#%E5%90%91%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6">å‘é¡¹ç›®ä¸­æ·»åŠ æ’ä»¶</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8plugman%E9%AA%8C%E8%AF%81%E6%8F%92%E4%BB%B6">ä½¿ç”¨PlugmanéªŒè¯æ’ä»¶</a></li>
<li><a href="#javascript%E6%8E%A5%E5%8F%A3">JavaScriptæ¥å£</a></li>
<li><a href="#native%E5%B1%82%E5%AE%9E%E7%8E%B0">Nativeå±‚å®ç°</a>
<ul>
<li><a href="#android%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E8%AF%B4%E6%98%8E">Androidæ’ä»¶å¼€å‘è¯´æ˜</a>
<ul>
<li><a href="#%E6%8F%92%E4%BB%B6%E7%B1%BB%E6%98%A0%E5%B0%84">æ’ä»¶ç±»æ˜ å°„</a></li>
<li><a href="#%E6%8F%92%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">æ’ä»¶åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="#%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAandroid%E6%8F%92%E4%BB%B6">ç¼–å†™ä¸€ä¸ªAndroidæ’ä»¶</a></li>
<li><a href="#%E7%BA%BF%E7%A8%8B">çº¿ç¨‹</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%BA%93">æ·»åŠ ä¾èµ–åº“</a>
<ul>
<li><a href="#%E6%96%B9%E6%B3%951">æ–¹æ³•1:</a></li>
<li><a href="#%E6%96%B9%E6%B3%952">æ–¹æ³•2:</a></li>
</ul>
</li>
<li><a href="#android%E6%95%B4%E5%90%88">Androidæ•´åˆ</a></li>
<li><a href="#android%E9%9D%99%E6%80%81%E6%9D%83%E9%99%90">Androidé™æ€æƒé™</a></li>
<li><a href="#android%E8%BF%90%E8%A1%8C%E6%97%B6%E6%9D%83%E9%99%90">Androidè¿è¡Œæ—¶æƒé™</a></li>
<li><a href="#%E5%90%AF%E5%8A%A8%E5%85%B6%E4%BB%96%E6%B4%BB%E5%8A%A8">å¯åŠ¨å…¶ä»–æ´»åŠ¨</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%8F%91%E5%B8%83%E6%8F%92%E4%BB%B6">å‘å¸ƒæ’ä»¶</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://merpyzf.github.io/post/guan-yu-callbackcontext-zhong-de-sendpluginresult-fang-fa-de-zuo-yong/">
              <h3 class="post-title">
                å…³äºCallbackContextä¸­çš„sendPluginResultæ–¹æ³•çš„ä½œç”¨
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://merpyzf.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
